"use client"

import React, { useState, useEffect, useMemo, useCallback, useRef } from "react"
import { useRouter } from "next/navigation"
import { Search, MapPin, Calendar, Sparkles, Activity, Car, Utensils } from "lucide-react"
import { Button } from "@/components/ui/button"
import { Input } from "@/components/ui/input"
import { toast } from "sonner"
import Image from "next/image"
import { useUnifiedData } from "@/hooks/use-unified-data"

interface HeroSectionProps {
  onSearch?: (filters: { query: string; category: string; date: string }) => void
}

interface SmartSuggestion {
  type: 'service' | 'category' | 'subcategory'
  id: string
  title: string
  category?: string
  subcategory?: string
  count?: number
  price?: number
  duration?: number
  location?: string
  icon: string
  searchTerm: string
  difficulty?: string
  featured?: boolean
}

export const HeroSection = React.memo(function HeroSection({ onSearch }: HeroSectionProps) {
  const [searchQuery, setSearchQuery] = useState("")
  const [selectedLocation, setSelectedLocation] = useState("")
  const [date, setDate] = useState("")
  const [isSearching, setIsSearching] = useState(false)
  const [isHovered, setIsHovered] = useState(false)
  const [minDate, setMinDate] = useState("")
  const [isClient, setIsClient] = useState(false)
  const [imageLoaded, setImageLoaded] = useState(false)
  const [imageError, setImageError] = useState(false)
  const [currentImageIndex, setCurrentImageIndex] = useState(0)
  const router = useRouter()
  const searchTimeoutRef = useRef<NodeJS.Timeout>()

  // Obtener datos de la base de datos
  const { services, categories, subcategories } = useUnifiedData()

  // Funci√≥n para obtener icono de categor√≠a
  const getCategoryIcon = (categoryId: string) => {
    switch (categoryId) {
      case 'actividades':
        return 'üèîÔ∏è'
      case 'renting':
        return 'üöó'
      case 'gastronomia':
        return 'üçΩÔ∏è'
      default:
        return 'üéØ'
    }
  }

  // Funci√≥n para obtener icono espec√≠fico del servicio
  const getServiceIcon = (categoryId: string, subcategoryId: string) => {
    // Iconos espec√≠ficos por subcategor√≠a
    switch (subcategoryId) {
      case 'excursiones':
        return 'üó∫Ô∏è'
      case 'aventura':
        return 'üßó'
      case 'acuaticas':
        return 'üåä'
      case 'naturaleza':
        return 'üåø'
      case 'coches':
        return 'üöó'
      case 'motos':
        return 'üèçÔ∏è'
      case 'bicicletas':
        return 'üö≤'
      case 'especiales':
        return 'üöê'
      case 'restaurantes':
        return 'üçΩÔ∏è'
      case 'tours':
        return 'ü•ò'
      case 'talleres':
        return 'üë®‚Äçüç≥'
      case 'eventos':
        return 'üéâ'
      default:
        return getCategoryIcon(categoryId)
    }
  }

  // Lista de im√°genes de respaldo en orden de preferencia
  const fallbackImages = useMemo(() => [
    "/images/hero-background.avif",
    "/images/hero-tenerife-sunset.jpg",
    "/images/teide_sunset.jpg",
    "/images/volcanic_landscape.jpg",
    "/images/teide_crater.jpg"
  ], [])

  // Sugerencias inteligentes basadas en datos reales de la base de datos
  const smartSuggestions = useMemo(() => {
    if (!services || !categories || !subcategories) {
      return []
    }

    const suggestions: SmartSuggestion[] = []

    // 1. Servicios destacados (featured) - PRIORIDAD ALTA
    const featuredServices = services.filter(s => s.featured).slice(0, 6)
    
    featuredServices.forEach(service => {
      const category = categories.find(c => c.id === service.category_id)
      const subcategory = subcategories.find(sc => sc.id === service.subcategory_id)
      
      suggestions.push({
        type: 'service',
        id: service.id,
        title: service.title,
        category: category?.name || '',
        subcategory: subcategory?.name || '',
        count: undefined,
        price: service.price,
        duration: service.duration,
        location: service.location,
        icon: getServiceIcon(service.category_id, service.subcategory_id || ''),
        searchTerm: service.title,
        difficulty: service.difficulty_level,
        featured: true
      })
    })

    // 2. Servicios populares por categor√≠a (si no hay suficientes destacados)
    if (suggestions.length < 6) {
      const popularByCategory = categories.map(category => {
        const categoryServices = services.filter(s => s.category_id === category.id)
        return {
          category,
          services: categoryServices.slice(0, 2) // Top 2 por categor√≠a
        }
      })

      popularByCategory.forEach(({ category, services: categoryServices }) => {
        categoryServices.forEach(service => {
          // Solo agregar si no est√° ya en las sugerencias
          if (!suggestions.find(s => s.id === service.id)) {
            const subcategory = subcategories.find(sc => sc.id === service.subcategory_id)
            suggestions.push({
              type: 'service',
              id: service.id,
              title: service.title,
              category: category.name,
              subcategory: subcategory?.name || '',
              count: undefined,
              price: service.price,
              duration: service.duration,
              location: service.location,
              icon: getServiceIcon(service.category_id, service.subcategory_id || ''),
              searchTerm: service.title,
              difficulty: service.difficulty_level,
              featured: false
            })
          }
        })
      })
    }

    // 3. Servicios econ√≥micos (si a√∫n no tenemos suficientes)
    if (suggestions.length < 6) {
      const affordableServices = services
        .filter(s => s.price < 50 && !suggestions.find(existing => existing.id === s.id))
        .sort((a, b) => a.price - b.price)
        .slice(0, 6 - suggestions.length)
      
      affordableServices.forEach(service => {
        const category = categories.find(c => c.id === service.category_id)
        const subcategory = subcategories.find(sc => sc.id === service.subcategory_id)
        
        suggestions.push({
          type: 'service',
          id: service.id,
          title: service.title,
          category: category?.name || '',
          subcategory: subcategory?.name || '',
          count: undefined,
          price: service.price,
          duration: service.duration,
          location: service.location,
          icon: getServiceIcon(service.category_id, service.subcategory_id || ''),
          searchTerm: service.title,
          difficulty: service.difficulty_level,
          featured: false
        })
      })
    }

    // Limitar a 6 sugerencias principales
    return suggestions.slice(0, 6)
  }, [services, categories, subcategories])

  // Establecer fecha m√≠nima solo en el cliente para evitar errores de hidrataci√≥n
  useEffect(() => {
    setIsClient(true)
    setMinDate(new Date().toISOString().split('T')[0])
    
    // Cleanup para el timeout de b√∫squeda
    return () => {
      if (searchTimeoutRef.current) {
        clearTimeout(searchTimeoutRef.current)
      }
    }
  }, [])

  // Memoizar la funci√≥n de b√∫squeda para evitar re-renders
  const handleSearch = useCallback(async () => {
    try {
      setIsSearching(true)
      
      // Validar que al menos hay un criterio de b√∫squeda
      if (!searchQuery.trim() && !selectedLocation && !date) {
        toast.error("Por favor, ingresa al menos un criterio de b√∫squeda")
        setIsSearching(false)
        return
      }

      // Construir URL con par√°metros de b√∫squeda
      const searchParams = new URLSearchParams()
      
      if (searchQuery.trim()) {
        searchParams.set("query", searchQuery.trim())
      }
      
      if (selectedLocation && selectedLocation !== "todas") {
        searchParams.set("location", selectedLocation)
      }
      
      if (date) {
        searchParams.set("date", date)
      }

      // Llamar callback si existe (para compatibilidad)
      if (onSearch) {
        onSearch({
          query: searchQuery,
          category: selectedLocation,
          date
        })
      }

      // Mostrar toast de confirmaci√≥n
      toast.success("Buscando experiencias...")

      // Redirigir a la p√°gina de servicios con los filtros
      const searchUrl = `/services?${searchParams.toString()}`
      
      // Usar router.push para evitar problemas de navegaci√≥n
      await router.push(searchUrl)
      
      // Limpiar el estado despu√©s de la navegaci√≥n exitosa
      setTimeout(() => {
        setSearchQuery("")
        setSelectedLocation("")
        setDate("")
      }, 100)

    } catch (error) {
      console.error("Error en b√∫squeda:", error)
      toast.error("Error al realizar la b√∫squeda. Intenta de nuevo.")
    } finally {
      setIsSearching(false)
    }
  }, [searchQuery, selectedLocation, date, onSearch, router])

  // Funci√≥n de b√∫squeda con debounce para evitar m√∫ltiples llamadas
  const debouncedSearch = useCallback(() => {
    if (searchTimeoutRef.current) {
      clearTimeout(searchTimeoutRef.current)
    }
    
    searchTimeoutRef.current = setTimeout(() => {
      handleSearch()
    }, 300)
  }, [handleSearch])

  // Manejar b√∫squeda con Enter
  const handleKeyPress = useCallback((e: React.KeyboardEvent) => {
    if (e.key === "Enter" && !isSearching) {
      e.preventDefault()
      debouncedSearch()
    }
  }, [debouncedSearch, isSearching])
    if (!services || !categories || !subcategories) {
      return []
    }

    const suggestions: SmartSuggestion[] = []

    // 1. Servicios destacados (featured) - PRIORIDAD ALTA
    const featuredServices = services.filter(s => s.featured).slice(0, 6)
    
    featuredServices.forEach(service => {
      const category = categories.find(c => c.id === service.category_id)
      const subcategory = subcategories.find(sc => sc.id === service.subcategory_id)
      
      suggestions.push({
        type: 'service',
        id: service.id,
        title: service.title,
        category: category?.name || '',
        subcategory: subcategory?.name || '',
        count: undefined,
        price: service.price,
        duration: service.duration,
        location: service.location,
        icon: getServiceIcon(service.category_id, service.subcategory_id || ''),
        searchTerm: service.title,
        difficulty: service.difficulty_level,
        featured: true
      })
    })

    // 2. Servicios populares por categor√≠a (si no hay suficientes destacados)
    if (suggestions.length < 6) {
      const popularByCategory = categories.map(category => {
        const categoryServices = services.filter(s => s.category_id === category.id)
        return {
          category,
          services: categoryServices.slice(0, 2) // Top 2 por categor√≠a
        }
      })

      popularByCategory.forEach(({ category, services: categoryServices }) => {
        categoryServices.forEach(service => {
          // Solo agregar si no est√° ya en las sugerencias
          if (!suggestions.find(s => s.id === service.id)) {
            const subcategory = subcategories.find(sc => sc.id === service.subcategory_id)
            suggestions.push({
              type: 'service',
              id: service.id,
              title: service.title,
              category: category.name,
              subcategory: subcategory?.name || '',
              count: undefined,
              price: service.price,
              duration: service.duration,
              location: service.location,
              icon: getServiceIcon(service.category_id, service.subcategory_id || ''),
              searchTerm: service.title,
              difficulty: service.difficulty_level,
              featured: false
            })
          }
        })
      })
    }

    // 3. Servicios econ√≥micos (si a√∫n no tenemos suficientes)
    if (suggestions.length < 6) {
      const affordableServices = services
        .filter(s => s.price < 50 && !suggestions.find(existing => existing.id === s.id))
        .sort((a, b) => a.price - b.price)
        .slice(0, 6 - suggestions.length)
      
      affordableServices.forEach(service => {
        const category = categories.find(c => c.id === service.category_id)
        const subcategory = subcategories.find(sc => sc.id === service.subcategory_id)
        
        suggestions.push({
          type: 'service',
          id: service.id,
          title: service.title,
          category: category?.name || '',
          subcategory: subcategory?.name || '',
          count: undefined,
          price: service.price,
          duration: service.duration,
          location: service.location,
          icon: getServiceIcon(service.category_id, service.subcategory_id || ''),
          searchTerm: service.title,
          difficulty: service.difficulty_level,
          featured: false
        })
      })
    }

    // Limitar a 6 sugerencias principales
    return suggestions.slice(0, 6)
  }, [services, categories, subcategories])

  // Manejar error de imagen con fallback autom√°tico
  const handleImageError = useCallback(() => {
    console.error(`‚ùå Error cargando imagen del hero: ${fallbackImages[currentImageIndex]}`)
    
    // Intentar con la siguiente imagen si hay m√°s disponibles
    if (currentImageIndex < fallbackImages.length - 1) {
      setCurrentImageIndex(prev => prev + 1)
      setImageError(false)
      setImageLoaded(false)
    } else {
      // Si todas las im√°genes fallaron, mostrar fallback
      setImageError(true)
      console.error("‚ùå Todas las im√°genes del hero fallaron, usando gradiente")
    }
  }, [currentImageIndex, fallbackImages])

  // Manejar carga exitosa de imagen
  const handleImageLoad = useCallback(() => {
    setImageLoaded(true)
    setImageError(false)
    console.log(`‚úÖ Imagen del hero cargada exitosamente: ${fallbackImages[currentImageIndex]}`)
  }, [currentImageIndex, fallbackImages])

  // Imagen de fondo con fallback robusto
  const heroImageSrc = useMemo(() => {
    return fallbackImages[currentImageIndex]
  }, [currentImageIndex, fallbackImages])

  return (
    <section className="relative min-h-screen flex items-center justify-center overflow-hidden">
      {/* Imagen de fondo optimizada con manejo de errores */}
      <div className="absolute inset-0 z-0">
        {!imageError ? (
          <>
            <Image
              src={heroImageSrc}
              alt="Tenerife Paradise Tour - Paisaje de Tenerife"
              fill
              priority
              quality={85}
              className={`object-cover transition-opacity duration-1000 ${
                imageLoaded ? 'opacity-100' : 'opacity-0'
              }`}
              onLoad={handleImageLoad}
              onError={handleImageError}
              sizes="100vw"
            />
            
            {/* Indicador de carga */}
            {!imageLoaded && (
              <div className="absolute inset-0 bg-gradient-to-br from-blue-900 via-purple-900 to-indigo-900 flex items-center justify-center">
                <div className="text-center text-white">
                  <div className="w-16 h-16 border-4 border-white/20 border-t-white rounded-full animate-spin mx-auto mb-4" />
                  <p className="text-lg font-medium">Cargando experiencia...</p>
                  <p className="text-sm text-white/70 mt-2">
                    Imagen {currentImageIndex + 1} de {fallbackImages.length}
                  </p>
                </div>
              </div>
            )}
          </>
        ) : (
          // Fallback cuando hay error en la imagen - gradiente atractivo
          <div className="w-full h-full bg-gradient-to-br from-blue-900 via-purple-900 to-indigo-900 flex items-center justify-center">
            <div className="text-center text-white">
              <div className="w-20 h-20 bg-white/10 rounded-full flex items-center justify-center mx-auto mb-4">
                <span className="text-3xl">üèîÔ∏è</span>
              </div>
              <h3 className="text-xl font-semibold mb-2">Tenerife Paradise Tour</h3>
              <p className="text-white/70">Descubre la magia de la isla</p>
            </div>
          </div>
        )}
        
        {/* Overlay gradiente para mejor legibilidad */}
        <div className="absolute inset-0 bg-gradient-to-r from-black/50 via-black/30 to-black/50" />
      </div>

      {/* Contenido principal */}
      <div className="relative z-20 text-center text-white px-4 max-w-6xl mx-auto">
        {/* Sugerencias destacadas en la parte superior */}
        <div className="mb-12 animate-fade-in-up">
          <h2 className="text-2xl md:text-3xl font-bold mb-6 text-white/90">
            üî• Experiencias Destacadas de Tenerife
          </h2>
          <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 max-w-5xl mx-auto">
            {!services || !categories || !subcategories ? (
              // Estado de carga
              <div className="col-span-full text-center py-8">
                <div className="w-8 h-8 border-2 border-white/30 border-t-white rounded-full animate-spin mx-auto mb-3" />
                <p className="text-white/70 text-sm">Cargando experiencias...</p>
              </div>
            ) : smartSuggestions.length === 0 ? (
              // Estado sin sugerencias
              <div className="col-span-full text-center py-8">
                <span className="text-4xl mb-3 block">üèùÔ∏è</span>
                <p className="text-white/70 text-sm">No hay experiencias disponibles</p>
                <p className="text-white/50 text-xs mt-1">Intenta m√°s tarde</p>
              </div>
            ) : (
              // Sugerencias disponibles
              smartSuggestions.slice(0, 6).map((suggestion) => (
                <div
                  key={`${suggestion.type}-${suggestion.id}`}
                  className="bg-white/10 backdrop-blur-sm border border-white/20 rounded-xl p-4 hover:bg-white/20 transition-all duration-300 cursor-pointer group"
                  onClick={async () => {
                    setSearchQuery(suggestion.searchTerm)
                    // Peque√±o delay para que se actualice el estado
                    await new Promise(resolve => setTimeout(resolve, 50))
                    debouncedSearch()
                  }}
                >
                  <div className="text-left">
                    <div className="flex items-start justify-between mb-3">
                      <span className="text-2xl">{suggestion.icon}</span>
                      {suggestion.featured && (
                        <span className="text-xs bg-yellow-500/20 text-yellow-300 px-2 py-1 rounded-full font-medium border border-yellow-500/30">
                          ‚≠ê Destacado
                        </span>
                      )}
                    </div>
                    <div className="font-semibold text-white group-hover:text-yellow-300 transition-colors mb-2">
                      {suggestion.title}
                    </div>
                    <div className="flex items-center gap-2 mb-2">
                      {suggestion.category && (
                        <span className="text-xs bg-white/20 text-white/80 px-2 py-1 rounded-full">
                          {suggestion.category}
                        </span>
                      )}
                      {suggestion.subcategory && (
                        <span className="text-xs bg-blue-500/20 text-blue-300 px-2 py-1 rounded-full">
                          {suggestion.subcategory}
                        </span>
                      )}
                    </div>
                    <div className="flex items-center gap-3 text-xs text-white/70 mb-3">
                      {suggestion.location && (
                        <span className="flex items-center gap-1">
                          <MapPin className="h-3 w-3" />
                          {suggestion.location}
                        </span>
                      )}
                      {suggestion.duration && (
                        <span className="flex items-center gap-1">
                          <Calendar className="h-3 w-3" />
                          {Math.round(suggestion.duration / 60)}h
                        </span>
                      )}
                      {suggestion.difficulty && (
                        <span className="flex items-center gap-1">
                          <Sparkles className="h-3 w-3" />
                          {suggestion.difficulty}
                        </span>
                      )}
                    </div>
                    {suggestion.price && (
                      <div className="text-right">
                        <span className="text-lg font-bold text-green-400">
                          ‚Ç¨{suggestion.price}
                        </span>
                      </div>
                    )}
                  </div>
                </div>
              ))
            )}
          </div>
        </div>

        <div className="mb-8">
          <h1 className="text-5xl md:text-7xl font-bold mb-6 animate-fade-in-up">
            Tenerife Paradise Tour
          </h1>
          <p className="text-xl md:text-2xl mb-8 max-w-3xl mx-auto animate-fade-in-up animation-delay-200">
            Descubre la magia de Tenerife con nuestras experiencias √∫nicas y tours personalizados
          </p>
        </div>

        {/* Formulario de b√∫squeda s√∫per sencillo con autocompletado */}
        <div className="max-w-2xl mx-auto animate-fade-in-up animation-delay-400 relative z-20">
          <div className="relative group">
            {/* Barra de b√∫squeda minimalista */}
            <div className="relative">
              <Input
                type="text"
                placeholder={isSearching ? "Buscando experiencias..." : "Buscar experiencias..."}
                value={searchQuery}
                onChange={(e) => setSearchQuery(e.target.value)}
                onKeyPress={handleKeyPress}
                onFocus={() => setIsHovered(true)}
                onBlur={() => setTimeout(() => setIsHovered(false), 200)}
                disabled={isSearching}
                className={`w-full h-14 pl-6 pr-16 text-lg bg-white/95 backdrop-blur-sm border-2 transition-all duration-300 rounded-full shadow-lg placeholder:text-gray-500 ${
                  isSearching 
                    ? 'border-blue-400 bg-blue-50/95 cursor-not-allowed' 
                    : 'border-white/40 focus:bg-white focus:border-blue-400 focus:ring-4 focus:ring-blue-400/20'
                }`}
              />
              
              {/* Bot√≥n de b√∫squeda integrado */}
              <Button
                onClick={debouncedSearch}
                disabled={isSearching}
                className="absolute right-2 top-1/2 transform -translate-y-1/2 h-10 px-4 bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700 text-white font-medium rounded-full transition-all duration-300 transform hover:scale-105 shadow-md hover:shadow-lg disabled:opacity-70 disabled:cursor-not-allowed"
              >
                {isSearching ? (
                  <div className="flex items-center space-x-2">
                    <div className="w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin" />
                    <span className="text-sm">Buscando...</span>
                  </div>
                ) : (
                  <Search className="h-5 w-5" />
                )}
              </Button>
            </div>
            
            {/* Panel de sugerencias de autocompletado simplificado */}
            {searchQuery && (
              <div className="absolute top-full left-0 right-0 mt-2 bg-white/95 backdrop-blur-sm border border-white/40 rounded-2xl shadow-xl overflow-hidden z-20 animate-fade-in-up max-h-96 overflow-y-auto">
                {/* Sugerencias principales */}
                <div className="p-4 border-b border-gray-100">
                  <h3 className="text-sm font-medium text-gray-700 mb-3 flex items-center gap-2">
                    <span className="text-orange-500">üî•</span>
                    Experiencias Destacadas de Tenerife
                  </h3>
                  <div className="grid grid-cols-1 gap-3">
                    {!services || !categories || !subcategories ? (
                      // Estado de carga
                      <div className="text-center py-8">
                        <div className="w-8 h-8 border-2 border-blue-500 border-t-transparent rounded-full animate-spin mx-auto mb-3" />
                        <p className="text-gray-500 text-sm">Cargando experiencias...</p>
                      </div>
                    ) : smartSuggestions.length === 0 ? (
                      // Estado sin sugerencias
                      <div className="text-center py-8">
                        <span className="text-4xl mb-3 block">üèùÔ∏è</span>
                        <p className="text-gray-500 text-sm">No hay experiencias disponibles</p>
                        <p className="text-gray-400 text-xs mt-1">Intenta m√°s tarde</p>
                      </div>
                    ) : (
                      // Sugerencias disponibles
                      smartSuggestions.map((suggestion) => (
                      <button
                        key={`${suggestion.type}-${suggestion.id}`}
                        onClick={async () => {
                          setSearchQuery(suggestion.searchTerm)
                          // Peque√±o delay para que se actualice el estado
                          await new Promise(resolve => setTimeout(resolve, 50))
                          debouncedSearch()
                        }}
                        className="w-full text-left p-4 rounded-xl hover:bg-gradient-to-r hover:from-blue-50 hover:to-indigo-50 transition-all duration-300 text-sm text-gray-700 hover:text-blue-600 group border border-gray-100 hover:border-blue-200 hover:shadow-md"
                      >
                        <div className="flex items-start justify-between">
                          <div className="flex items-start space-x-3 flex-1">
                            <span className="text-2xl mt-1">{suggestion.icon}</span>
                            <div className="text-left flex-1">
                              <div className="font-semibold text-gray-800 group-hover:text-blue-700 transition-colors">
                                {suggestion.title}
                              </div>
                              <div className="flex items-center gap-2 mt-1">
                                {suggestion.category && (
                                  <span className="text-xs bg-gray-100 text-gray-600 px-2 py-1 rounded-full">
                                    {suggestion.category}
                                  </span>
                                )}
                                {suggestion.subcategory && (
                                  <span className="text-xs bg-blue-50 text-blue-600 px-2 py-1 rounded-full">
                                    {suggestion.subcategory}
                                  </span>
                                )}
                              </div>
                              <div className="flex items-center gap-3 mt-2 text-xs text-gray-500">
                                {suggestion.location && (
                                  <span className="flex items-center gap-1">
                                    <MapPin className="h-3 w-3" />
                                    {suggestion.location}
                                  </span>
                                )}
                                {suggestion.duration && (
                                  <span className="flex items-center gap-1">
                                    <Calendar className="h-3 w-3" />
                                    {Math.round(suggestion.duration / 60)}h
                                  </span>
                                )}
                                {suggestion.difficulty && (
                                  <span className="flex items-center gap-1">
                                    <Sparkles className="h-3 w-3" />
                                    {suggestion.difficulty}
                                  </span>
                                )}
                              </div>
                            </div>
                          </div>
                          <div className="flex flex-col items-end space-y-2 ml-4">
                            {suggestion.featured && (
                              <span className="text-xs bg-yellow-100 text-yellow-700 px-2 py-1 rounded-full font-medium">
                                ‚≠ê Destacado
                              </span>
                            )}
                            {suggestion.price && (
                              <span className="text-sm bg-green-100 text-green-700 px-3 py-1 rounded-full font-semibold">
                                ‚Ç¨{suggestion.price}
                              </span>
                            )}
                            <span className="text-blue-400 opacity-0 group-hover:opacity-100 transition-opacity text-lg">
                              ‚Üí
                            </span>
                          </div>
                        </div>
                      </button>
                        ))
                      )}
                  </div>
                </div>
                
                {/* Sugerencias de autocompletado */}
                {searchQuery && (
                  <div className="p-4">
                    <h3 className="text-sm font-medium text-gray-700 mb-3 flex items-center gap-2">
                      <span className="text-blue-500">üí°</span>
                      Sugerencias Relacionadas
                    </h3>
                    <div className="space-y-2">
                      {smartSuggestions
                        .filter(suggestion => 
                          suggestion.searchTerm.toLowerCase().includes(searchQuery.toLowerCase()) ||
                          (suggestion.category && suggestion.category.toLowerCase().includes(searchQuery.toLowerCase())) ||
                          (suggestion.subcategory && suggestion.subcategory.toLowerCase().includes(searchQuery.toLowerCase()))
                        )
                        .slice(0, 4)
                        .map((suggestion) => (
                          <button
                            key={`search-${suggestion.type}-${suggestion.id}`}
                            onClick={async () => {
                              setSearchQuery(suggestion.searchTerm)
                              // Peque√±o delay para que se actualice el estado
                              await new Promise(resolve => setTimeout(resolve, 50))
                              debouncedSearch()
                            }}
                            className="w-full text-left p-3 rounded-lg hover:bg-blue-50 transition-colors duration-200 text-sm text-gray-700 hover:text-blue-600 flex items-center justify-between group"
                          >
                            <div className="flex items-center space-x-3">
                              <span className="text-lg">{suggestion.icon}</span>
                              <div className="text-left">
                                <div className="font-medium">{suggestion.searchTerm}</div>
                                {suggestion.category && (
                                  <div className="text-xs text-gray-500">{suggestion.category}</div>
                                )}
                              </div>
                            </div>
                            <div className="flex items-center space-x-2">
                              {suggestion.price && (
                                <span className="text-xs bg-green-100 text-green-600 px-2 py-1 rounded-full">
                                  ‚Ç¨{suggestion.price}
                                </span>
                              )}
                              <span className="text-blue-400 opacity-0 group-hover:opacity-100 transition-opacity">
                                ‚Üí
                              </span>
                            </div>
                          </button>
                        ))
                      }
                    </div>
                  </div>
                )}
              </div>
            )}
          </div>
          
          {/* Informaci√≥n minimalista */}
          <div className="mt-4 text-center">
            <p className="text-white/70 text-xs">
              üí° Haz clic para ver experiencias reales de Tenerife con precios y detalles
            </p>
          </div>
        </div>

        {/* Indicadores de caracter√≠sticas */}
        <div className="mt-12 animate-fade-in-up animation-delay-800">
          <div className="flex items-center justify-center gap-8 text-white/80">
            <div className="flex items-center gap-2">
              <MapPin className="h-5 w-5" />
              <span className="text-sm">+50 Destinos</span>
            </div>
            <div className="flex items-center gap-2">
              <Calendar className="h-5 w-5" />
              <span className="text-sm">Reserva 24/7</span>
            </div>
            <div className="flex items-center gap-2">
              <Sparkles className="h-5 w-5" />
              <span className="text-sm">Experiencias √önicas</span>
            </div>
          </div>
          
          {/* Indicador de estado de b√∫squeda */}
          {isSearching && (
            <div className="mt-6 flex items-center justify-center gap-3 text-white/90 animate-pulse">
              <div className="w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin" />
              <span className="text-sm font-medium">Redirigiendo a servicios...</span>
            </div>
          )}
        </div>
      </div>
    </section>
  )
})
